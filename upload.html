<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-900 font-sans p-8">
  <h1 class="text-3xl font-bold mb-4">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</h1>
  <form id="clientForm" class="space-y-6">
    <section>
      <h2 class="text-xl font-bold mb-2">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
      <div class="mb-4">
        <label for="name" class="block mb-1">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
        <input type="text" id="name" required class="w-full border rounded p-2">
      </div>
      <div class="mb-4">
        <label for="email" class="block mb-1">Email</label>
        <input type="email" id="email" required class="w-full border rounded p-2">
      </div>
    </section>

    <section>
      <h2 class="text-xl font-bold mb-2">–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è</h2>
      <div class="mb-4">
        <label for="gender" class="block mb-1">–ü–æ–ª –∫–ª–∏–µ–Ω—Ç–∞</label>
        <input type="text" id="gender" class="w-full border rounded p-2">
      </div>
      <div class="mb-4">
        <label for="age" class="block mb-1">–í–æ–∑—Ä–∞—Å—Ç</label>
        <input type="text" id="age" class="w-full border rounded p-2">
      </div>
      <div class="mb-4">
        <label for="income" class="block mb-1">–î–æ—Ö–æ–¥</label>
        <input type="text" id="income" class="w-full border rounded p-2">
      </div>
      <div class="mb-4">
        <label for="interests" class="block mb-1">–ò–Ω—Ç–µ—Ä–µ—Å—ã</label>
        <textarea id="interests" class="w-full border rounded p-2"></textarea>
      </div>
      <div class="mb-4">
        <label for="location" class="block mb-1">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</label>
        <textarea id="location" class="w-full border rounded p-2"></textarea>
      </div>
    </section>

    <section>
      <h2 class="text-xl font-bold mb-2">–ë—Ä–∏—Ñ</h2>
      <div class="mb-4">
        <label for="product" class="block mb-1">–ü—Ä–æ–¥—É–∫—Ç</label>
        <input type="text" id="product" class="w-full border rounded p-2">
      </div>
      <div class="mb-4">
        <label for="competitors" class="block mb-1">–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã</label>
        <textarea id="competitors" class="w-full border rounded p-2"></textarea>
      </div>
      <div class="mb-4">
        <label for="goal" class="block mb-1">–¶–µ–ª—å –∫–∞—Ä—Ç–æ—á–µ–∫</label>
        <textarea id="goal" class="w-full border rounded p-2"></textarea>
      </div>
      <div class="mb-4">
        <label for="tone" class="block mb-1">–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</label>
        <textarea id="tone" class="w-full border rounded p-2"></textarea>
      </div>
      <div class="mb-4">
        <label for="brand_character" class="block mb-1">–•–∞—Ä–∞–∫—Ç–µ—Ä –±—Ä–µ–Ω–¥–∞</label>
        <textarea id="brand_character" class="w-full border rounded p-2"></textarea>
      </div>
    </section>

    <section>
      <h2 class="text-xl font-bold mb-2">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫</h2>
      <div class="mb-4">
        <label for="card_a" class="block mb-1">–ö–∞—Ä—Ç–æ—á–∫–∞ A</label>
        <input type="file" id="card_a" name="card_a" accept="image/*" required class="w-full border rounded p-2">
      </div>
      <div class="mb-4">
        <label for="card_b" class="block mb-1">–ö–∞—Ä—Ç–æ—á–∫–∞ B</label>
        <input type="file" id="card_b" name="card_b" accept="image/*" required class="w-full border rounded p-2">
      </div>
    </section>

    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold px-6 py-3 rounded text-lg">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>
  <p id="message" class="mt-4 hidden"></p>

  <script>
    document.getElementById('clientForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const get = id => document.getElementById(id).value.trim();

      const name = get('name');
      const email = get('email');
      const gender = get('gender');
      const age = get('age');
      const income = get('income');
      const interests = get('interests');
      const locationVal = get('location');
      const product = get('product');
      const competitors = get('competitors');
      const goal = get('goal');
      const tone = get('tone');
      const brand_character = get('brand_character');

      const cardAFile = document.getElementById('card_a').files[0];
      const cardBFile = document.getElementById('card_b').files[0];
      const message = document.getElementById('message');
      message.className = 'mt-4 hidden';

      const token = 'patvJS0DnoqPhKvNn.447d13a744908303e6e26d5434e55c96604325f7f1649618f89ac29749179235';
      const baseId = 'appE0enoPi7oPUy5g';
      const tableId = 'tbl5GTrO0C8kYtIuz';

      async function uploadAttachment(file) {
        const fd = new FormData();
        fd.append('file', file, file.name);
        const res = await fetch(`https://api.airtable.com/v0/bases/${baseId}/attachments`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${token}` },
          body: fd
        });
        if (!res.ok) throw new Error('File upload failed');
        return res.json();
      }

      try {
        const [aData, bData] = await Promise.all([
          uploadAttachment(cardAFile),
          uploadAttachment(cardBFile)
        ]);

        const payload = {
          records: [{
            fields: {
              name: name,
              email: email,
              gender: gender,
              age: age,
              income: income,
              interests: interests,
              location: locationVal,
              product: product,
              competitors: competitors,
              goal: goal,
              tone: tone,
              brand_character: brand_character,
              card_a: [{ url: aData.url }],
              card_b: [{ url: bData.url }]
            }
          }]
        };

        const resp = await fetch(`https://api.airtable.com/v0/${baseId}/${tableId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(payload)
        });

        if (!resp.ok) throw new Error('Request failed');

        message.textContent = 'üéâ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!';
        message.className = 'mt-4 text-green-600';
        form.reset();
      } catch (err) {
        message.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö';
        message.className = 'mt-4 text-red-600';
      }
    });
  </script>
</body>
</html>
